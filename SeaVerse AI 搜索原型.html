<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <script type="module" src="/@vite/client"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SeaVerse AI æœç´¢åŸå‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-top: 20px;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            color: #a0a0a0;
            font-size: 14px;
        }

        .main-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }

        .input-section h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #e0e0e0;
        }

        .input-wrapper {
            position: relative;
            margin-bottom: 20px;
        }

        #userInput {
            width: 100%;
            padding: 15px 20px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #fff;
            outline: none;
            transition: all 0.3s;
        }

        #userInput:focus {
            border-color: #667eea;
            background: rgba(255, 255, 255, 0.12);
        }

        #userInput::placeholder {
            color: #777;
        }

        .button-group {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 12px 30px;
            font-size: 16px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            flex: 1;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            padding: 12px 20px;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .history-section {
            margin-top: 30px;
        }

        .history-section h3 {
            font-size: 16px;
            color: #a0a0a0;
            margin-bottom: 15px;
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .history-item {
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .history-item .status {
            font-size: 18px;
        }

        .result-section {
            display: none;
        }

        .result-section.active {
            display: block;
        }

        .thinking-box {
            padding: 20px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(102, 126, 234, 0.3);
            margin: 20px 0;
            text-align: center;
        }

        .thinking-box .spinner {
            width: 40px;
            height: 40px;
            margin: 0 auto 15px;
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .decision-panel {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .decision-panel h3 {
            font-size: 18px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .decision-section {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .decision-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .decision-section h4 {
            font-size: 14px;
            color: #667eea;
            margin-bottom: 10px;
        }

        .decision-section p {
            color: #c0c0c0;
            line-height: 1.6;
            font-size: 14px;
        }

        .skill-tag {
            display: inline-block;
            padding: 4px 12px;
            background: rgba(102, 126, 234, 0.2);
            border-radius: 6px;
            font-size: 13px;
            margin: 5px 5px 5px 0;
        }

        .result-image {
            width: 100%;
            height: 400px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .result-image-placeholder {
            color: #666;
            font-size: 14px;
        }

        .feedback-section {
            margin-top: 20px;
        }

        .feedback-section h4 {
            font-size: 16px;
            margin-bottom: 15px;
        }

        .feedback-buttons {
            display: flex;
            gap: 10px;
        }

        .btn-feedback {
            flex: 1;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-feedback:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: #667eea;
        }

        .discover-section {
            margin-top: 20px;
        }

        .discover-title {
            font-size: 18px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .discover-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .discover-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s;
        }

        .discover-card:hover {
            transform: translateY(-5px);
            border-color: #667eea;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
        }

        .discover-card-image {
            width: 100%;
            height: 120px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
        }

        .discover-card-content {
            padding: 15px;
        }

        .discover-card-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 5px;
            color: #fff;
        }

        .discover-card-desc {
            font-size: 12px;
            color: #999;
            line-height: 1.4;
        }

        .toggle-details {
            color: #667eea;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
            display: inline-block;
        }

        .toggle-details:hover {
            text-decoration: underline;
        }

        .hidden {
            display: none;
        }

        .multi-skill-result {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .skill-result-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .skill-result-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .skill-result-header h4 {
            font-size: 16px;
            color: #667eea;
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 10px;
            }

            .main-card {
                padding: 20px;
            }

            .discover-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒŠ SeaVerse AI æœç´¢åŸå‹</h1>
            <p>åŸºäºç”¨æˆ·å†å²çš„æ™ºèƒ½æŠ€èƒ½åŒ¹é…ç³»ç»Ÿ</p>
        </div>

        <div class="main-card">
            <div class="input-section">
                <h2>ğŸ’¬ å‘Šè¯‰æˆ‘ä½ æƒ³åšä»€ä¹ˆ</h2>
                <div class="input-wrapper">
                    <input type="text" id="userInput" placeholder="ä¾‹å¦‚ï¼šç”»ä¸€åªå¯çˆ±çš„çŒ«å’ªã€ç”Ÿæˆäº§å“ä»‹ç»è§†é¢‘ã€åˆ¶ä½œéŸ³ä¹..." />
                </div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="generateContent()">ğŸš€ å¼€å§‹ç”Ÿæˆï¼ˆæ¨¡æ‹Ÿï¼‰</button>
                    <button class="btn btn-primary" onclick="realGenerateWithAssistant()" style="background: linear-gradient(135deg, #51cf66, #37b24d);">âœ¨ çœŸå®ç”Ÿæˆï¼ˆè°ƒç”¨ AIï¼‰</button>
                    <button class="btn btn-secondary" onclick="clearHistory()">ğŸ—‘ï¸ æ¸…ç©ºå†å²</button>
                </div>
            </div>

            <div class="history-section">
                <h3>ğŸ“œ å†å²è®°å½• (<span id="historyCount">0</span> æ¬¡)</h3>
                <div class="history-list" id="historyList">
                    <div style="color: #666; font-size: 14px; text-align: center; padding: 20px;">
                        æš‚æ— å†å²è®°å½•
                    </div>
                </div>
            </div>
        </div>

        <div class="main-card result-section" id="resultSection">
            <div class="thinking-box" id="thinkingBox">
                <div class="spinner"></div>
                <p>ğŸ¤– AI æ­£åœ¨ä¸ºä½ ç”Ÿæˆ...</p>
                <p style="font-size: 12px; color: #999; margin-top: 5px;">é¢„è®¡ <span id="estimatedTime">10</span> ç§’å®Œæˆ</p>
                <p class="toggle-details" onclick="toggleDetails()">ğŸ” æŸ¥çœ‹è¯¦æƒ…</p>
            </div>

            <div class="decision-panel hidden" id="decisionPanel">
                <h3>ğŸ” AI å†³ç­–è¿‡ç¨‹</h3>
                <div id="decisionContent"></div>
            </div>

            <div class="hidden" id="resultContent">
                <div id="multiSkillResults" class="multi-skill-result"></div>

                <div class="feedback-section">
                    <h4>ğŸ’¬ ç»“æœæ»¡æ„å—ï¼Ÿ</h4>
                    <div class="feedback-buttons">
                        <button class="btn-feedback" onclick="giveFeedback('satisfied')">ğŸ˜Š å¾ˆæ»¡æ„</button>
                        <button class="btn-feedback" onclick="giveFeedback('retry')">ğŸ˜ æ¢ä¸€ä¸ª</button>
                        <button class="btn-feedback" onclick="giveFeedback('adjust')">ğŸ”§ æˆ‘è¦è°ƒæ•´</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="main-card discover-section hidden" id="discoverSection">
            <div class="discover-title">
                <span>âœ¨</span>
                <span>Discover more</span>
            </div>
            <p style="color: #999; font-size: 14px; margin-bottom: 15px;" id="discoverMessage"></p>
            <div class="discover-cards" id="discoverCards"></div>
        </div>
    </div>

    <script>
        const skills = [
            {
                id: "api_jimeng_4_0",
                name: "å³æ¢¦ 4.0",
                display_name: "Image - Jimeng 4.0",
                type: "image",
                tags: ["image", "cute", "chinese", "fast"],
                bestFor: "å¯çˆ±é£æ ¼ã€ä¸­æ–‡ç†è§£ã€å¿«é€Ÿç”Ÿæˆ",
                promptStyle: "è¯¦ç»†ä¸­æ–‡æè¿° + é£æ ¼å…³é”®è¯",
                example: "ä¸€åªå¯çˆ±çš„æ©˜è‰²å°çŒ«å’ªï¼Œæ¯›èŒ¸èŒ¸çš„ï¼Œå¤§çœ¼ç›..."
            },
            {
                id: "api_midjourney_v6",
                name: "Midjourney v6",
                display_name: "Image - Midjourney v6",
                type: "image",
                tags: ["image", "professional", "realistic", "quality"],
                bestFor: "å†™å®é£æ ¼ã€ä¸“ä¸šæ‘„å½±ã€æœ€é«˜è´¨é‡",
                promptStyle: "è‹±æ–‡ä¸“ä¸šæœ¯è¯­ + æ‘„å½±å‚æ•°",
                example: "professional cat portrait, studio lighting..."
            },
            {
                id: "api_kling_v2_6",
                name: "Kling v2.6",
                display_name: "Video - Kling v2.6",
                type: "video",
                tags: ["video", "audio", "professional", "sync"],
                bestFor: "éŸ³è§†é¢‘åŒæ­¥ã€ä¸“ä¸šçº§è´¨é‡ã€äº§å“ä»‹ç»",
                promptStyle: "è¯¦ç»†åœºæ™¯æè¿° + è¿é•œè¦æ±‚",
                example: "äº§å“åœ¨é˜³å…‰ä¸‹å±•ç¤ºï¼Œæ…¢é•œå¤´ç‰¹å†™..."
            },
            {
                id: "api_wanx25_t2v",
                name: "Wanx 2.5",
                display_name: "Video - Wanx 2.5",
                type: "video",
                tags: ["video", "fast", "economical"],
                bestFor: "å¿«é€Ÿç”Ÿæˆã€æ€§ä»·æ¯”é«˜ã€æ¦‚å¿µéªŒè¯",
                promptStyle: "ç®€æ´åœºæ™¯æè¿°",
                example: "ä¸€åªçŒ«åœ¨èŠ±å›­é‡Œç©è€"
            },
            {
                id: "api_mureka_song",
                name: "Mureka Song",
                display_name: "Audio - Mureka Song",
                type: "audio",
                tags: ["audio", "music", "song"],
                bestFor: "å®Œæ•´æ­Œæ›²ç”Ÿæˆã€å¤šç§é£æ ¼",
                promptStyle: "é£æ ¼ + æƒ…æ„Ÿ + ä¸»é¢˜",
                example: "è½»å¿«çš„æµè¡Œæ­Œæ›²ï¼Œå…³äºå¤å¤©"
            }
        ];

        let userHistory = [];
        let currentSession = null;

        function init() {
            loadHistory();
            updateHistoryDisplay();
        }

        async function generateContent() {
            const input = document.getElementById('userInput').value.trim();
            if (!input) {
                alert('è¯·è¾“å…¥ä½ çš„éœ€æ±‚');
                return;
            }

            document.getElementById('resultSection').classList.add('active');
            document.getElementById('thinkingBox').classList.remove('hidden');
            document.getElementById('decisionPanel').classList.add('hidden');
            document.getElementById('resultContent').classList.add('hidden');

            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });

            // AI å†³ç­–
            const decision = aiDecision(input, userHistory);
            displayDecision(decision);

            // æ¨¡æ‹Ÿæ€è€ƒåŠ¨ç”»
            await simulateThinking();

            // æ˜¾ç¤ºæ¨¡æ‹Ÿç»“æœ
            displayResult(decision);
            saveToHistory(input, decision);
            checkDiscoverRecommendation();
        }

        function simulateThinkingAnimation() {
            let time = 10;
            const timer = setInterval(() => {
                time--;
                document.getElementById('estimatedTime').textContent = time;
                if (time <= 0) {
                    clearInterval(timer);
                }
            }, 500);
        }

        async function realGeneration(decision) {
            const results = [];

            for (const skill of decision.skills) {
                const prompt = decision.optimizedPrompts[decision.skills.indexOf(skill)];

                if (skill.type === 'image') {
                    // è°ƒç”¨å›¾åƒç”Ÿæˆ
                    const result = await callImageSkill(skill.id, prompt);
                    results.push(result);
                } else if (skill.type === 'video') {
                    // è°ƒç”¨è§†é¢‘ç”Ÿæˆ
                    const result = await callVideoSkill(skill.id, prompt);
                    results.push(result);
                } else if (skill.type === 'audio') {
                    // è°ƒç”¨éŸ³é¢‘ç”Ÿæˆ
                    const result = await callAudioSkill(skill.id, prompt);
                    results.push(result);
                }
            }

            return results;
        }

        async function callImageSkill(skillId, prompt) {
            // ä½¿ç”¨ Skill è°ƒç”¨å›¾åƒç”Ÿæˆ
            const response = await fetch('/api/generate-image', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    skillId: skillId,
                    prompt: prompt
                })
            });

            if (!response.ok) throw new Error('å›¾åƒç”Ÿæˆå¤±è´¥');
            return await response.json();
        }

        async function callVideoSkill(skillId, prompt) {
            const response = await fetch('/api/generate-video', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    skillId: skillId,
                    prompt: prompt
                })
            });

            if (!response.ok) throw new Error('è§†é¢‘ç”Ÿæˆå¤±è´¥');
            return await response.json();
        }

        async function callAudioSkill(skillId, prompt) {
            const response = await fetch('/api/generate-audio', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    skillId: skillId,
                    prompt: prompt
                })
            });

            if (!response.ok) throw new Error('éŸ³é¢‘ç”Ÿæˆå¤±è´¥');
            return await response.json();
        }

        function displayRealResult(decision, results) {
            document.getElementById('thinkingBox').classList.add('hidden');
            document.getElementById('resultContent').classList.remove('hidden');

            const multiResults = decision.skills.map((skill, index) => {
                const result = results[index];
                let mediaHtml = '';

                if (skill.type === 'image' && result.imageUrl) {
                    mediaHtml = `<img src="${result.imageUrl}" style="width: 100%; border-radius: 12px;" />`;
                } else if (skill.type === 'video' && result.videoUrl) {
                    mediaHtml = `<video src="${result.videoUrl}" controls style="width: 100%; border-radius: 12px;"></video>`;
                } else if (skill.type === 'audio' && result.audioUrl) {
                    mediaHtml = `<audio src="${result.audioUrl}" controls style="width: 100%;"></audio>`;
                } else {
                    mediaHtml = '<div class="result-image-placeholder">ç”Ÿæˆä¸­...</div>';
                }

                return `
                    <div class="skill-result-item">
                        <div class="skill-result-header">
                            <h4>ğŸ¨ ${skill.display_name}</h4>
                            <span style="color: #51cf66; font-size: 12px;">âœ… ç”ŸæˆæˆåŠŸ</span>
                        </div>
                        <div style="margin: 20px 0;">
                            ${mediaHtml}
                        </div>
                        <p style="font-size: 13px; color: #999;">ä½¿ç”¨çš„ Prompt: ${decision.optimizedPrompts[index]}</p>
                    </div>
                `;
            }).join('');

            document.getElementById('multiSkillResults').innerHTML = multiResults;
        }

        function simulateThinking() {
            return new Promise(resolve => {
                let time = 10;
                const timer = setInterval(() => {
                    time--;
                    document.getElementById('estimatedTime').textContent = time;
                    if (time <= 0) {
                        clearInterval(timer);
                        resolve();
                    }
                }, 200);
            });
        }

        function simulateGeneration(skillCount) {
            return new Promise(resolve => {
                setTimeout(resolve, 1000 * skillCount);
            });
        }

        function aiDecision(input, history) {
            const lowerInput = input.toLowerCase();
            const preference = analyzePreference(history);

            let selectedSkills = [];
            let reason = "";

            if (lowerInput.includes('ä»‹ç»è§†é¢‘') || lowerInput.includes('å®£ä¼ ç‰‡') || (lowerInput.includes('è§†é¢‘') && lowerInput.includes('éŸ³ä¹'))) {
                selectedSkills = [
                    skills.find(s => s.id === 'api_kling_v2_6'),
                    skills.find(s => s.id === 'api_mureka_song')
                ];
                reason = "æ£€æµ‹åˆ°ä½ éœ€è¦å®Œæ•´çš„è§†é¢‘åˆ¶ä½œæµç¨‹ï¼Œæˆ‘ä¸ºä½ ç»„åˆäº†è§†é¢‘ç”Ÿæˆå’ŒéŸ³ä¹åˆ›ä½œä¸¤ä¸ªæŠ€èƒ½";
            }
            else if (lowerInput.includes('ç”»') || lowerInput.includes('å›¾') || lowerInput.includes('ç…§ç‰‡') || lowerInput.includes('çŒ«') || lowerInput.includes('ç‹—')) {
                if (preference.style === 'cute') {
                    selectedSkills = [skills.find(s => s.id === 'api_jimeng_4_0')];
                    reason = `åŸºäºä½ çš„å†å²åå¥½ï¼ˆ${preference.cuteCount}æ¬¡å¯çˆ±é£æ ¼ï¼‰ï¼Œé€‰æ‹©å³æ¢¦ 4.0`;
                } else if (preference.style === 'professional') {
                    selectedSkills = [skills.find(s => s.id === 'api_midjourney_v6')];
                    reason = `åŸºäºä½ çš„å†å²åå¥½ï¼ˆ${preference.professionalCount}æ¬¡ä¸“ä¸šé£æ ¼ï¼‰ï¼Œé€‰æ‹© Midjourney v6`;
                } else {
                    selectedSkills = [skills.find(s => s.id === 'api_jimeng_4_0')];
                    reason = "é¦–æ¬¡ä½¿ç”¨ï¼Œæ¨èä¸­æ–‡å‹å¥½çš„å³æ¢¦ 4.0";
                }
            }
            else if (lowerInput.includes('è§†é¢‘')) {
                selectedSkills = [skills.find(s => s.id === 'api_kling_v2_6')];
                reason = "ä¸“ä¸šè§†é¢‘ç”Ÿæˆéœ€æ±‚ï¼Œé€‰æ‹© Kling v2.6";
            }
            else if (lowerInput.includes('éŸ³ä¹') || lowerInput.includes('æ­Œ')) {
                selectedSkills = [skills.find(s => s.id === 'api_mureka_song')];
                reason = "éŸ³ä¹åˆ›ä½œéœ€æ±‚ï¼Œé€‰æ‹© Mureka Song";
            }
            else {
                selectedSkills = [skills.find(s => s.id === 'api_jimeng_4_0')];
                reason = "é€šç”¨éœ€æ±‚ï¼Œé€‰æ‹©å³æ¢¦ 4.0";
            }

            const optimizedPrompts = selectedSkills.map(skill => optimizePrompt(input, skill, preference));

            return {
                input: input,
                understanding: analyzeIntent(input, preference),
                skills: selectedSkills,
                reason: reason,
                optimizedPrompts: optimizedPrompts,
                params: inferParams(preference)
            };
        }

        function analyzePreference(history) {
            if (history.length === 0) {
                return { style: 'unknown', cuteCount: 0, professionalCount: 0 };
            }

            let cuteCount = 0;
            let professionalCount = 0;

            history.forEach(item => {
                if (item.style === 'cute') cuteCount++;
                if (item.style === 'professional') professionalCount++;
            });

            return {
                style: cuteCount > professionalCount ? 'cute' : (professionalCount > 0 ? 'professional' : 'unknown'),
                cuteCount: cuteCount,
                professionalCount: professionalCount
            };
        }

        function analyzeIntent(input, preference) {
            const lowerInput = input.toLowerCase();
            let intent = "ç”Ÿæˆå†…å®¹";

            if (lowerInput.includes('ç”»') || lowerInput.includes('å›¾')) {
                intent = "ç”Ÿæˆå›¾åƒ";
            } else if (lowerInput.includes('è§†é¢‘')) {
                intent = "ç”Ÿæˆè§†é¢‘";
            } else if (lowerInput.includes('éŸ³ä¹') || lowerInput.includes('æ­Œ')) {
                intent = "ç”ŸæˆéŸ³ä¹";
            }

            let styleGuess = "é£æ ¼æœªçŸ¥";
            if (preference.style === 'cute') {
                styleGuess = `å¯çˆ±é£æ ¼ï¼ˆåŸºäºä½ ä¹‹å‰${preference.cuteCount}æ¬¡åå¥½ï¼‰`;
            } else if (preference.style === 'professional') {
                styleGuess = `ä¸“ä¸šé£æ ¼ï¼ˆåŸºäºä½ ä¹‹å‰${preference.professionalCount}æ¬¡åå¥½ï¼‰`;
            } else if (lowerInput.includes('å¯çˆ±') || lowerInput.includes('èŒ')) {
                styleGuess = "å¯çˆ±é£æ ¼";
            } else if (lowerInput.includes('ä¸“ä¸š') || lowerInput.includes('å•†ä¸š')) {
                styleGuess = "ä¸“ä¸šé£æ ¼";
            }

            return `${intent}ï¼Œ${styleGuess}`;
        }

        function optimizePrompt(input, skill, preference) {
            if (skill.type === 'image') {
                if (skill.id === 'api_jimeng_4_0') {
                    return `${input}ï¼Œæ¯›èŒ¸èŒ¸çš„ï¼Œå¤§çœ¼ç›ï¼Œæ¸©æš–çš„å…‰çº¿ï¼Œé«˜æ¸…ç»†èŠ‚ï¼Œæ²»æ„ˆç³»æ’ç”»é£æ ¼`;
                } else if (skill.id === 'api_midjourney_v6') {
                    return `professional ${input}, studio lighting, high quality, 8k resolution, commercial photography`;
                }
            } else if (skill.type === 'video') {
                return `${input}ï¼Œé•œå¤´å¹³ç¨³ç§»åŠ¨ï¼Œè‡ªç„¶å…‰çº¿ï¼Œé«˜æ¸…ç”»è´¨`;
            } else if (skill.type === 'audio') {
                return `${input}ï¼Œæµè¡Œé£æ ¼ï¼Œè½»å¿«èŠ‚å¥`;
            }
            return input;
        }

        function inferParams(preference) {
            return {
                resolution: "1024x1024",
                duration: "10ç§’",
                quality: "high"
            };
        }

        function displayDecision(decision) {
            const content = `
                <div class="decision-section">
                    <h4>ğŸ“Š æˆ‘çš„ç†è§£</h4>
                    <p>${decision.understanding}</p>
                </div>

                <div class="decision-section">
                    <h4>ğŸ¯ æŠ€èƒ½é€‰æ‹© (${decision.skills.length}ä¸ª)</h4>
                    <p style="margin-bottom: 10px;">${decision.reason}</p>
                    ${decision.skills.map((skill, index) => `
                        <div style="margin: 10px 0;">
                            <span class="skill-tag">âœ… ${skill.display_name}</span>
                            <p style="margin-top: 5px; font-size: 13px;">é€‚ç”¨äºï¼š${skill.bestFor}</p>
                        </div>
                    `).join('')}
                </div>

                <div class="decision-section">
                    <h4>âœï¸ Prompt ä¼˜åŒ–</h4>
                    ${decision.skills.map((skill, index) => `
                        <div style="margin: 15px 0;">
                            <p style="color: #999; font-size: 13px; margin-bottom: 5px;">${skill.display_name}:</p>
                            <p style="color: #ff6b6b;">åŸå§‹è¾“å…¥ï¼š"${decision.input}"</p>
                            <p style="color: #51cf66; margin-top: 5px;">ä¼˜åŒ–åï¼š"${decision.optimizedPrompts[index]}"</p>
                        </div>
                    `).join('')}
                </div>

                <div class="decision-section">
                    <h4>âš™ï¸ å‚æ•°æ¨æ–­</h4>
                    <p>â€¢ åˆ†è¾¨ç‡ï¼š${decision.params.resolution}</p>
                    <p>â€¢ æ—¶é•¿ï¼š${decision.params.duration}</p>
                    <p>â€¢ è´¨é‡ï¼š${decision.params.quality}</p>
                </div>
            `;

            document.getElementById('decisionContent').innerHTML = content;
        }

        function displayResult(decision) {
            document.getElementById('thinkingBox').classList.add('hidden');
            document.getElementById('resultContent').classList.remove('hidden');

            const multiResults = decision.skills.map((skill, index) => {
                return `
                    <div class="skill-result-item">
                        <div class="skill-result-header">
                            <h4>ğŸ¨ ${skill.display_name}</h4>
                            <span style="color: #51cf66; font-size: 12px;">âœ… ç”ŸæˆæˆåŠŸ</span>
                        </div>
                        <div class="result-image">
                            <div class="result-image-placeholder">
                                [${skill.type === 'image' ? 'å›¾åƒ' : skill.type === 'video' ? 'è§†é¢‘' : 'éŸ³é¢‘'}ç”Ÿæˆç»“æœå ä½]
                            </div>
                        </div>
                        <p style="font-size: 13px; color: #999;">ä½¿ç”¨çš„ Prompt: ${decision.optimizedPrompts[index]}</p>
                    </div>
                `;
            }).join('');

            document.getElementById('multiSkillResults').innerHTML = multiResults;
        }

        function saveToHistory(input, decision) {
            const historyItem = {
                input: input,
                skills: decision.skills.map(s => s.id),
                style: decision.understanding.includes('å¯çˆ±') ? 'cute' : 'professional',
                satisfied: true,
                timestamp: new Date().toISOString()
            };

            userHistory.push(historyItem);
            if (userHistory.length > 10) {
                userHistory.shift();
            }

            localStorage.setItem('seaverse_history', JSON.stringify(userHistory));
            updateHistoryDisplay();
        }

        function updateHistoryDisplay() {
            const list = document.getElementById('historyList');
            const count = document.getElementById('historyCount');

            count.textContent = userHistory.length;

            if (userHistory.length === 0) {
                list.innerHTML = '<div style="color: #666; font-size: 14px; text-align: center; padding: 20px;">æš‚æ— å†å²è®°å½•</div>';
                return;
            }

            const html = userHistory.slice().reverse().map(item => `
                <div class="history-item">
                    <span class="status">${item.satisfied ? 'âœ…' : 'âŒ'}</span>
                    <span>${item.input}</span>
                    <span style="margin-left: auto; font-size: 12px; color: #666;">${item.style === 'cute' ? 'å¯çˆ±é£æ ¼' : 'ä¸“ä¸šé£æ ¼'}</span>
                </div>
            `).join('');

            list.innerHTML = html;
        }

        function loadHistory() {
            const saved = localStorage.getItem('seaverse_history');
            if (saved) {
                userHistory = JSON.parse(saved);
            }
        }

        function clearHistory() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºå†å²è®°å½•å—ï¼Ÿ')) {
                userHistory = [];
                localStorage.removeItem('seaverse_history');
                updateHistoryDisplay();
                document.getElementById('discoverSection').classList.add('hidden');
            }
        }

        function toggleDetails() {
            const panel = document.getElementById('decisionPanel');
            panel.classList.toggle('hidden');
        }

        function giveFeedback(type) {
            if (type === 'satisfied') {
                alert('ğŸ˜Š å¤ªå¥½äº†ï¼å·²è®°å½•ä½ çš„åå¥½ï¼Œä¸‹æ¬¡ä¼šæ›´å‡†ç¡®ï¼');
            } else if (type === 'retry') {
                alert('ğŸ˜ å¥½çš„ï¼Œè®©æˆ‘é‡æ–°ç”Ÿæˆä¸€ä¸ª...');
            } else {
                alert('ğŸ”§ é«˜çº§è°ƒæ•´åŠŸèƒ½å¼€å‘ä¸­...');
            }
        }

        function checkDiscoverRecommendation() {
            if (userHistory.length >= 5) {
                const pattern = detectPattern(userHistory);
                if (pattern) {
                    showDiscoverRecommendation(pattern);
                }
            }
        }

        function detectPattern(history) {
            const recentTasks = history.slice(-5);
            const cuteCount = recentTasks.filter(t => t.style === 'cute').length;

            if (cuteCount >= 4) {
                return {
                    type: 'cute_animal',
                    message: 'ä½ å·²ç»ç”Ÿæˆäº†å¤šå¼ å¯çˆ±åŠ¨ç‰©å›¾ç‰‡',
                    suggestions: [
                        { emoji: 'ğŸ¨', title: 'ç”Ÿæˆè¡¨æƒ…åŒ…', desc: 'ç”¨åŒä¸€é£æ ¼ç”Ÿæˆå¤šä¸ªè¡¨æƒ…' },
                        { emoji: 'ğŸ“±', title: 'åˆ¶ä½œæ‰‹æœºå£çº¸', desc: 'é€‚é…ä¸åŒè®¾å¤‡å°ºå¯¸' },
                        { emoji: 'ğŸ’¾', title: 'ä¿å­˜é…ç½®', desc: 'ä¸‹æ¬¡ä¸€é”®ç”Ÿæˆ' },
                        { emoji: 'ğŸ¬', title: 'åˆ¶ä½œåŠ¨ç”»', desc: 'å°†å›¾ç‰‡è½¬ä¸ºçŸ­è§†é¢‘' }
                    ]
                };
            }

            return null;
        }

        function showDiscoverRecommendation(pattern) {
            document.getElementById('discoverSection').classList.remove('hidden');
            document.getElementById('discoverMessage').textContent = pattern.message;

            const cards = pattern.suggestions.map(sug => `
                <div class="discover-card" onclick="handleDiscoverClick('${sug.title}')">
                    <div class="discover-card-image">${sug.emoji}</div>
                    <div class="discover-card-content">
                        <div class="discover-card-title">${sug.title}</div>
                        <div class="discover-card-desc">${sug.desc}</div>
                    </div>
                </div>
            `).join('');

            document.getElementById('discoverCards').innerHTML = cards;

            setTimeout(() => {
                document.getElementById('discoverSection').scrollIntoView({ behavior: 'smooth' });
            }, 500);
        }

        function handleDiscoverClick(title) {
            alert(`ä½ é€‰æ‹©äº†ï¼š${title}\n\nè¿™ä¸ªåŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...`);
        }

        // çœŸå®ç”Ÿæˆ - é€šè¿‡ AI Assistant
        function realGenerateWithAssistant() {
            const input = document.getElementById('userInput').value.trim();
            if (!input) {
                // åœ¨é¡µé¢æ˜¾ç¤ºæç¤º
                showTip('è¯·è¾“å…¥ä½ çš„éœ€æ±‚');
                return;
            }

            const message = `è¯·å¸®æˆ‘çœŸå®ç”Ÿæˆï¼š${input}\n\nä½¿ç”¨ SeaVerse çš„ Skill çœŸå®è°ƒç”¨ API ç”Ÿæˆå†…å®¹ï¼Œå®Œæˆåå‘Šè¯‰æˆ‘ç»“æœã€‚`;

            // åœ¨é¡µé¢æ˜¾ç¤ºæ¶ˆæ¯
            showTip(`ğŸ¯ å‡†å¤‡çœŸå®ç”Ÿæˆï¼š"${input}"\n\nè¯·å¤åˆ¶ä¸‹æ–¹æ–‡å­—å‘é€ç»™æˆ‘ï¼š\n\n${message}`, true);
        }

        function showTip(message, isLarge = false) {
            // åˆ›å»ºæç¤ºæ¡†
            const tip = document.createElement('div');
            tip.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0, 0, 0, 0.95);
                color: white;
                padding: ${isLarge ? '30px' : '20px'};
                border-radius: 12px;
                z-index: 10000;
                max-width: ${isLarge ? '600px' : '400px'};
                white-space: pre-wrap;
                box-shadow: 0 10px 40px rgba(0,0,0,0.5);
                border: 1px solid rgba(102, 126, 234, 0.5);
            `;
            tip.textContent = message;

            // æ·»åŠ å…³é—­æŒ‰é’®
            const closeBtn = document.createElement('button');
            closeBtn.textContent = 'å…³é—­';
            closeBtn.style.cssText = `
                margin-top: 15px;
                padding: 8px 20px;
                background: #667eea;
                color: white;
                border: none;
                border-radius: 6px;
                cursor: pointer;
                width: 100%;
            `;
            closeBtn.onclick = () => document.body.removeChild(tip);
            tip.appendChild(closeBtn);

            document.body.appendChild(tip);
        }

        init();

        document.getElementById('userInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                generateContent();
            }
        });
    </script>

<!-- Element Selector Loader (Auto-injected by Vite) -->
<script>
(function() {
  console.log('[ElementSelectorLoader] Initializing...');
  let scriptInjected = false;
  window.addEventListener('message', function(event) {
    if (!event.data || event.data.type !== 'inject-element-selector-script') return;
    if (scriptInjected) { console.log('[ElementSelectorLoader] Script already injected, skipping'); return; }
    console.log('[ElementSelectorLoader] Received script injection request');
    const script = event.data.script;
    if (!script) { console.error('[ElementSelectorLoader] No script content received'); return; }
    try {
      const scriptElement = document.createElement('script');
      scriptElement.id = 'element-selector-injected';
      scriptElement.textContent = script;
      const target = document.head || document.body;
      if (target) {
        target.appendChild(scriptElement);
        scriptInjected = true;
        console.log('[ElementSelectorLoader] Script injected and executed successfully');
        if (window.parent) window.parent.postMessage({ type: 'element-selector-script-injected', success: true }, "*");
      } else {
        console.error('[ElementSelectorLoader] No head or body element found');
      }
    } catch (error) {
      console.error('[ElementSelectorLoader] Failed to inject script:', error);
      if (window.parent) window.parent.postMessage({ type: 'element-selector-script-injected', success: false, error: error.message }, "*");
    }
  });
  if (window.parent && window.parent !== window) {
    window.parent.postMessage({ type: 'element-selector-loader-ready' }, "*");
    console.log('[ElementSelectorLoader] Ready and waiting for injection request');
  }
})();
</script>
</body>
</html>
